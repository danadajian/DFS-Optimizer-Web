package com.optimizer.handler;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import handler.OptimizerHandler;
import org.junit.jupiter.api.Test;

import java.util.Arrays;
import java.util.List;
import java.util.Map;

import static org.junit.jupiter.api.Assertions.*;

public class OptimizerHandlerTest {
    OptimizerHandlerTest() throws JsonProcessingException {
    }

    private OptimizerHandler optimizerHandler = new OptimizerHandler();
    private String jsonString1 = "{\"players\":" +
            "[{\"position\":\"QB\",\"salary\":17500,\"playerId\":877745,\"name\":\"Lamar Jackson\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":24.85534436482395},{\"position\":\"QB\",\"salary\":14500,\"playerId\":727837,\"name\":\"Jared Goff\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":14.619536166151148},{\"position\":\"RB\",\"salary\":14000,\"playerId\":456613,\"name\":\"Mark Ingram II\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":10.51029090614641},{\"position\":\"RB\",\"salary\":13500,\"playerId\":694641,\"name\":\"Todd Gurley II\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":12.259985064967292},{\"position\":\"WR\",\"salary\":13000,\"playerId\":698227,\"name\":\"Cooper Kupp\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":11.751572823400206},{\"position\":\"TE\",\"salary\":12500,\"playerId\":820699,\"name\":\"Mark Andrews\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":12.272299783164433},{\"position\":\"WR\",\"salary\":11000,\"playerId\":555693,\"name\":\"Robert Woods\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":9.017893769720592},{\"position\":\"K\",\"salary\":10000,\"playerId\":448132,\"name\":\"Justin Tucker\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":10.975691095707708},{\"position\":\"K\",\"salary\":9500,\"playerId\":558684,\"name\":\"Greg Zuerlein\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":9.279259349794591},{\"position\":\"WR\",\"salary\":9500,\"playerId\":607864,\"name\":\"Brandin Cooks\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":8.54183625945283},{\"position\":\"WR\",\"salary\":9000,\"playerId\":976220,\"name\":\"Marquise Brown\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":12.101448632483145},{\"position\":\"RB\",\"salary\":8500,\"playerId\":739799,\"name\":\"Gus Edwards\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":3.5584564864805244},{\"position\":\"WR\",\"salary\":8000,\"playerId\":822367,\"name\":\"Josh Reynolds\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":0.3574222009252583},{\"position\":\"TE\",\"salary\":8000,\"playerId\":838487,\"name\":\"Gerald Everett\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":6.709850462185832},{\"position\":\"RB\",\"salary\":7500,\"playerId\":914372,\"name\":\"Darrell Henderson Jr.\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":2.014668085969284},{\"position\":\"RB\",\"salary\":7000,\"playerId\":604724,\"name\":\"Malcolm Brown\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":2.993398675407634},{\"position\":\"TE\",\"salary\":7000,\"playerId\":608753,\"name\":\"Nick Boyle\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":5.093284858294057},{\"position\":\"WR\",\"salary\":6500,\"playerId\":704254,\"name\":\"Seth Roberts\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":3.025578671445958},{\"position\":\"TE\",\"salary\":6000,\"playerId\":604176,\"name\":\"Tyler Higbee\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":3.5972770307058073},{\"position\":\"TE\",\"salary\":6000,\"playerId\":881956,\"name\":\"Hayden Hurst\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":4.135919897537878},{\"position\":\"WR\",\"salary\":5500,\"playerId\":835086,\"name\":\"Mike Thomas\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":0.038756146052198036},{\"position\":\"WR\",\"salary\":5500,\"playerId\":884553,\"name\":\"Miles Boykin\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":2.922669228422454},{\"position\":\"WR\",\"salary\":5500,\"playerId\":591586,\"name\":\"Willie Snead IV\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":5.393655118738044},{\"position\":\"RB\",\"salary\":5000,\"playerId\":923109,\"name\":\"Justice Hill\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":2.1655297456957077},{\"position\":\"WR\",\"salary\":5000,\"playerId\":607847,\"name\":\"De'Anthony Thomas\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":0.3280528264626037},{\"position\":\"TE\",\"salary\":5000,\"playerId\":740704,\"name\":\"Johnny Mundt\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":0.19027690282876625}]," +
            "\"whiteList\":[]," +
            "\"blackList\":[]," +
            "\"lineupMatrix\":[\"any\",\"any\",\"any\",\"any\",\"any\"],\"salaryCap\":60000}";
    private Map<String, Object> optimizeTest = new ObjectMapper().readValue(jsonString1, new TypeReference<Map<String, Object>>(){});

    private String jsonString2 = "{\"players\":" +
            "[{\"position\":\"QB\",\"salary\":17500,\"playerId\":877745,\"name\":\"Lamar Jackson\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":24.85534436482395},{\"position\":\"QB\",\"salary\":14500,\"playerId\":727837,\"name\":\"Jared Goff\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":14.619536166151148},{\"position\":\"RB\",\"salary\":14000,\"playerId\":456613,\"name\":\"Mark Ingram II\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":10.51029090614641},{\"position\":\"RB\",\"salary\":13500,\"playerId\":694641,\"name\":\"Todd Gurley II\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":12.259985064967292},{\"position\":\"WR\",\"salary\":13000,\"playerId\":698227,\"name\":\"Cooper Kupp\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":11.751572823400206},{\"position\":\"TE\",\"salary\":12500,\"playerId\":820699,\"name\":\"Mark Andrews\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":12.272299783164433},{\"position\":\"WR\",\"salary\":11000,\"playerId\":555693,\"name\":\"Robert Woods\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":9.017893769720592},{\"position\":\"K\",\"salary\":10000,\"playerId\":448132,\"name\":\"Justin Tucker\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":10.975691095707708},{\"position\":\"K\",\"salary\":9500,\"playerId\":558684,\"name\":\"Greg Zuerlein\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":9.279259349794591},{\"position\":\"WR\",\"salary\":9500,\"playerId\":607864,\"name\":\"Brandin Cooks\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":8.54183625945283},{\"position\":\"WR\",\"salary\":9000,\"playerId\":976220,\"name\":\"Marquise Brown\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":12.101448632483145},{\"position\":\"RB\",\"salary\":8500,\"playerId\":739799,\"name\":\"Gus Edwards\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":3.5584564864805244},{\"position\":\"WR\",\"salary\":8000,\"playerId\":822367,\"name\":\"Josh Reynolds\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":0.3574222009252583},{\"position\":\"TE\",\"salary\":8000,\"playerId\":838487,\"name\":\"Gerald Everett\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":6.709850462185832},{\"position\":\"RB\",\"salary\":7500,\"playerId\":914372,\"name\":\"Darrell Henderson Jr.\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":2.014668085969284},{\"position\":\"RB\",\"salary\":7000,\"playerId\":604724,\"name\":\"Malcolm Brown\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":2.993398675407634},{\"position\":\"TE\",\"salary\":7000,\"playerId\":608753,\"name\":\"Nick Boyle\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":5.093284858294057},{\"position\":\"WR\",\"salary\":6500,\"playerId\":704254,\"name\":\"Seth Roberts\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":3.025578671445958},{\"position\":\"TE\",\"salary\":6000,\"playerId\":604176,\"name\":\"Tyler Higbee\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":3.5972770307058073},{\"position\":\"TE\",\"salary\":6000,\"playerId\":881956,\"name\":\"Hayden Hurst\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":4.135919897537878},{\"position\":\"WR\",\"salary\":5500,\"playerId\":835086,\"name\":\"Mike Thomas\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":0.038756146052198036},{\"position\":\"WR\",\"salary\":5500,\"playerId\":884553,\"name\":\"Miles Boykin\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":2.922669228422454},{\"position\":\"WR\",\"salary\":5500,\"playerId\":591586,\"name\":\"Willie Snead IV\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":5.393655118738044},{\"position\":\"RB\",\"salary\":5000,\"playerId\":923109,\"name\":\"Justice Hill\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":2.1655297456957077},{\"position\":\"WR\",\"salary\":5000,\"playerId\":607847,\"name\":\"De'Anthony Thomas\",\"team\":\"Bal\",\"opponent\":\"@ LAR\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":0.3280528264626037},{\"position\":\"TE\",\"salary\":5000,\"playerId\":740704,\"name\":\"Johnny Mundt\",\"team\":\"LAR\",\"opponent\":\"v. Bal\",\"gameDate\":\"Mon 8:15PM EST\",\"projection\":0.19027690282876625}]," +
            "\"whiteList\":[]," +
            "\"blackList\":[448132,558684]," +
            "\"lineupMatrix\":[\"any\",\"any\",\"any\",\"any\",\"any\"],\"salaryCap\":60000}";

    private Map<String, Object> blackListTest = new ObjectMapper().readValue(jsonString2, new TypeReference<Map<String, Object>>(){});

    @Test
    void shouldHandleOptimizerInput() {
        List<Integer> result = optimizerHandler.handleRequest(optimizeTest);
        assertEquals(Arrays.asList(877745, 694641, 558684, 448132, 976220), result);
    }

    @Test
    void shouldHandleOptimizerWithBlackListInput() {
        List<Integer> result = optimizerHandler.handleRequest(blackListTest);
        assertTrue(!result.contains(448132));
        assertTrue(!result.contains(558684));
    }

    @Test
    void shouldHandleOptimizerWithWhiteListInput() {
        List<Integer> result = optimizerHandler.handleRequest(blackListTest);
        assertTrue(!result.contains(448132));
        assertTrue(!result.contains(558684));
    }
}
